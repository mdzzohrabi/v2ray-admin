(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[673],{7674:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/transactions",function(){return t(5538)}])},3657:function(e,n,t){"use strict";t.d(n,{M:function(){return m}});var r=t(2670),l=t(5893),i=t(4184),a=t.n(i),u=t(3067),o=t.n(u),s=t(1163),c=(t(7294),t(9713)),d=t(1211);function m(e){var n=e.date,t=e.className,i=void 0===t?"":t,u=e.containerClassName,m=void 0===u?"":u,x=e.full,v=void 0!==x&&x,h=e.precision,p=void 0!==h&&h,f=e.locale,b=void 0===f?"":f,g=e.options,j=void 0===g?void 0:g,N=(0,s.useRouter)(),y="en"==(null!==b&&void 0!==b?b:N.query.date);if(!n)return(0,l.jsx)(l.Fragment,{children:"-"});n=(0,r.Z)(n,Date)?n:new Date(n);var w=new Intl.DateTimeFormat(y?"en-US":"fa-IR-u-nu-latn",null!==j&&void 0!==j?j:{timeStyle:"medium",dateStyle:"full"}),k=p?(0,c.Bh)(n).text:o()(n).locale("fa").fromNow(),C=w.format(n);return v?(0,l.jsx)(d.G,{className:m,popup:(0,l.jsx)("span",{dir:"rtl",children:k}),children:(0,l.jsx)("span",{className:a()("block text-gray-900 text-rtl",i),children:C})}):(0,l.jsx)(d.G,{popup:C,className:m,children:(0,l.jsx)("span",{className:a()("block text-gray-500 text-rtl",i),children:k})})}},1016:function(e,n,t){"use strict";t.d(n,{C:function(){return o}});var r=t(6042),l=t(5893),i=t(4184),a=t.n(i),u=t(7294);function o(e){var n=e.value,t=e.children,i=e.onEdit,o=e.className,s=void 0===o?"":o,c=e.editable,d=void 0===c||c,m=e.input,x=e.postfix,v=this,h=(0,u.useState)(!1),p=h[0],f=h[1],b=(0,u.useState)(n),g=b[0],j=b[1];(0,u.useEffect)((function(){j(n)}),[n]);var N=(0,u.useCallback)((function(e){null===e||void 0===e||e.preventDefault(),null===i||void 0===i||i.call(v,g),f(!1)}),[g]);return d?p?(0,l.jsxs)("form",{onSubmit:N,children:[(0,l.jsx)("input",(0,r.Z)({type:"text",value:g,onChange:function(e){return j(e.currentTarget.value)},className:"ring-1 ring-slate-600 rounded-lg px-1"},m)),x,(0,l.jsx)("button",{className:"text-sm ml-1 bg-slate-200 rounded-lg px-2 hover:bg-slate-800 hover:text-white",type:"submit",children:"OK"}),(0,l.jsx)("button",{onClick:function(){return f(!1)},className:"text-sm ml-1 bg-slate-200 rounded-lg px-2 hover:bg-slate-800 hover:text-white",type:"button",children:"Cancel"})]}):(0,l.jsx)("span",{className:a()("text-blue-500 ml-2 cursor-pointer px-1 rounded-lg hover:ring-slate-400 hover:ring-1 block",s),onClick:function(){return f(!p)},children:t}):(0,l.jsx)("span",{className:a()("ml-2 px-1",s),children:t})}},1757:function(e,n,t){"use strict";t.d(n,{Z:function(){return s}});var r=t(5893),l=t(4184),i=t.n(l),a=t(7294),u=t(2687),o=t(5384);function s(e){var n=e.visible,t=void 0!==n&&n,l=e.text,s=void 0===l?"Actions":l,c=e.children,d=void 0===c?[]:c,m=this,x=(0,a.useState)(t),v=x[0],h=x[1],p=(0,a.useRef)();return(0,u.pN)(p,(function(){h(!1)})),(0,a.useEffect)((function(){"boolean"==typeof t&&h(t)}),[t,h]),(0,r.jsxs)("div",{className:"relative inline-block",children:[(0,r.jsx)("span",{onClick:function(){return h(!v)},className:i()(o.W.link,{"bg-slate-200":v}),children:s}),v?(0,r.jsx)("div",{ref:p,className:"min-w-[10rem] absolute z-50 right-0 top-full bg-white shadow-lg ring-1 ring-black ring-opacity-10 px-2 py-2 rounded-lg",children:(Array.isArray(d)?d:[d]).map((function(e,n){return e?(0,r.jsx)("div",{className:"py-1 px-2 border-b-[1px] border-b-gray-200 last:border-b-0 hover:bg-cyan-100 cursor-pointer",onClick:function(){var n;null===(n=e.props.action)||void 0===n||n.call(m,h)},children:e.props.children},n):null}))}):null]})}s.Item=function(e){return e.children,e.action,(0,r.jsx)("div",{})}},1211:function(e,n,t){"use strict";t.d(n,{G:function(){return u}});var r=t(5893),l=t(4184),i=t.n(l),a=t(7294);function u(e){var n=e.children,t=e.popup,l=e.className,u=void 0===l?"":l,o=(0,a.useState)(!1),s=o[0],c=o[1];return t?(0,r.jsxs)("div",{className:i()("inline relative cursor-help",u),onMouseOver:function(){return c(!0)},onMouseOut:function(){return c(!1)},children:[n,s?(0,r.jsx)("div",{className:"shadow-lg z-10 absolute top-full rounded-lg bg-white px-2 py-2 ring-1 ring-slate-400",children:t}):null]}):n}},5538:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return S}});var r=t(7568),l=t(6042),i=t(9396),a=t(828),u=t(655),o=t(5893),s=t(4184),c=t.n(s),d=t(9008),m=t.n(d),x=t(1163),v=t(7294),h=t(6501),p=t(8100),f=t(1272),b=t(1257),g=t(3657),j=t(1016),N=t(6550),y=t(1757);function w(e){var n=e.value,t=(new Intl.NumberFormat).format(n);return(0,o.jsxs)(o.Fragment,{children:[t," \u062a\u0648\u0645\u0627\u0646"]})}var k=t(4685),C=t(2687),Z=t(5384),_=t(9713);function S(){var e,n,t,s,d,S,P,D,T,F,E,A,I,O,R,W,M,U,z=(0,v.useContext)(f.I),G=(0,x.useRouter)(),q="1"==G.query.all,B=(0,v.useState)({}),H=B[0],K=B[1],X=(0,a.Z)((0,C.Ai)("transactions-view",{fullTime:!0,user:G.query.user,sortColumn:"",sortOrder:"asc",group:!0}),2),J=X[0],V=X[1],L=(0,C.G)(),Q=(0,p.ZP)("/transactions?key="+btoa(z.server.url),_.Pu.bind(this,z.server)),Y=Q.data,$=Q.mutate,ee=(0,p.ZP)("/inbounds_clients?key="+btoa(z.server.url),_.Pu.bind(this,z.server)),ne=ee.data,te=(ee.mutate,(0,v.useCallback)(function(){var e=(0,r.Z)((function(e){return(0,u.__generator)(this,(function(n){try{null===e||void 0===e||e.preventDefault(),(0,_.Pu)(z.server,"/transactions",(0,l.Z)({},H)),h.ZP.success("Transaction added successfull"),$()}catch(t){h.ZP.error(t.message)}return[2]}))}));return function(n){return e.apply(this,arguments)}}(),[H])),re=(0,v.useCallback)(function(){var e=(0,r.Z)((function(e){return(0,u.__generator)(this,(function(n){switch(n.label){case 0:return[4,(0,_.Pu)(z.server,"/remove_transaction",{id:e.id}).then((function(e){return h.ZP.success("Transaction removed successful")})).then((function(){return $()})).catch((function(e){return h.ZP.error(e)}))];case 1:return n.sent(),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),[]),le=(0,v.useCallback)(function(){var e=(0,r.Z)((function(e,n,t){return(0,u.__generator)(this,(function(r){switch(r.label){case 0:return[4,(0,_.Pu)(z.server,"/edit_transaction",{id:e.id,field:n,value:t}).then((function(e){return h.ZP.success("Transaction edited successful")})).then((function(){return $()})).catch((function(e){return h.ZP.error(e)}))];case 1:return r.sent(),[2]}}))}));return function(n,t,r){return e.apply(this,arguments)}}(),[]),ie=0;return Y=null===(n=null===(e=null===Y||void 0===Y?void 0:Y.map((function(e){var n;return ie+=null!==(n=Number(e.amount))&&void 0!==n?n:0,(0,i.Z)((0,l.Z)({},e),{remain:ie})})))||void 0===e?void 0:e.filter((function(e){return!J.user||e.user==J.user})))||void 0===n?void 0:n.sort((0,_.KJ)(J.sortColumn,"asc"==J.sortOrder)),(0,o.jsxs)(b.W,{children:[(0,o.jsx)(m(),{children:(0,o.jsx)("title",{children:"Transactions"})}),q?(0,o.jsx)("form",{onSubmit:te,children:(0,o.jsxs)(N.H_,{title:"Add Transaction",className:"mt-2 border-b-[1px] pb-3",horizontal:!1,data:H,dataSetter:K,children:[(0,o.jsx)(N.gN,{label:"User",htmlFor:"user",children:(0,o.jsxs)("select",{className:Z.W.input,id:"user",children:[(0,o.jsx)("option",{value:"",children:"-"}),(null!==ne&&void 0!==ne?ne:[]).map((function(e,n){return(0,o.jsx)("option",{value:e,children:e},n)}))]})}),(0,o.jsx)(N.gN,{label:"Description",htmlFor:"remark",children:(0,o.jsx)("input",{className:Z.W.input,id:"remark",dir:"rtl"})}),(0,o.jsx)(N.gN,{label:"Amount",htmlFor:"amount",children:(0,o.jsx)("input",{className:Z.W.input,id:"amount",type:"text"})}),(0,o.jsx)(N.gN,{label:"-",children:(0,o.jsx)("button",{type:"submit",className:Z.W.button,children:"Add Transaction"})})]})}):null,(0,o.jsxs)("div",{className:"flex flex-col lg:flex-row",children:[(0,o.jsxs)(N.H_,{title:"Billing",horizontal:!0,className:"border-b-[1px] lg:border-b-0",children:[(0,o.jsx)(N.gN,{label:"UnPaid",className:"rounded-lg bg-red-100 px-4 items-center align-middle whitespace-nowrap",children:(0,o.jsx)(w,{value:null!==(s=null===Y||void 0===Y?void 0:Y.filter((function(e){return(null!==(t=Number(e.amount))&&void 0!==t?t:0)>0})).reduce((function(e,n){return e+(Number(n.amount)||0)}),0))&&void 0!==s?s:0})}),(0,o.jsx)("span",{className:"text-lg font-bold px-2",children:"-"}),(0,o.jsx)(N.gN,{label:"Paid",className:"rounded-lg bg-green-100 px-4 items-center align-middle whitespace-nowrap",children:(0,o.jsx)(w,{value:null!==(S=null===Y||void 0===Y?void 0:Y.filter((function(e){return(null!==(d=Number(e.amount))&&void 0!==d?d:0)<0})).reduce((function(e,n){return e+(Math.abs(Number(n.amount))||0)}),0))&&void 0!==S?S:0})}),(0,o.jsx)("span",{className:"text-lg font-bold px-2",children:"="}),(0,o.jsx)(N.gN,{label:"Remain",className:"rounded-lg bg-slate-100 px-4 items-center align-middle whitespace-nowrap",children:(0,o.jsx)(w,{value:null!==(P=null===Y||void 0===Y?void 0:Y.reduce((function(e,n){return e+(Number(n.amount)||0)}),0))&&void 0!==P?P:0})})]}),(0,o.jsxs)(N.H_,{className:"my-2",data:J,dataSetter:V,title:"View",horizontal:!0,children:[(0,o.jsx)(N.gN,{htmlFor:"fullTime",label:"Full Time",children:(0,o.jsx)("input",{type:"checkbox",id:"fullTime"})}),(0,o.jsx)(N.gN,{htmlFor:"group",label:"Group",children:(0,o.jsx)("input",{type:"checkbox",id:"group"})}),(0,o.jsx)(N.gN,{htmlFor:"sortColumn",label:"Sort",children:(0,o.jsxs)("select",{className:Z.W.input,id:"sortColumn",children:[(0,o.jsx)("option",{value:"",children:"-"}),(0,o.jsx)("option",{value:"user",children:"User"}),(0,o.jsx)("option",{value:"remark",children:"Remark"}),(0,o.jsx)("option",{value:"amount",children:"Amount"}),(0,o.jsx)("option",{value:"createDate",children:"Create Date"})]})}),(0,o.jsx)(N.gN,{htmlFor:"sortOrder",label:"Sort Order",children:(0,o.jsxs)("select",{className:Z.W.input,id:"sortOrder",children:[(0,o.jsx)("option",{value:"asc",children:"ASC"}),(0,o.jsx)("option",{value:"desc",children:"DESC"})]})}),(0,o.jsx)(N.gN,{label:"User",htmlFor:"user",children:(0,o.jsxs)("select",{className:Z.W.input,id:"user",children:[(0,o.jsx)("option",{value:"",children:"-"}),(null!==ne&&void 0!==ne?ne:[]).map((function(e,n){return(0,o.jsx)("option",{value:e,children:e},n)}))]})})]})]}),(0,o.jsx)(k.i,{rows:null!==Y&&void 0!==Y?Y:[],columns:["ID","User","Remark","Debt","Paid","Remain","Dates","Actions"],groupBy:function(e){return J.group&&e.createDate?new Intl.DateTimeFormat("fa-IR",{month:"long",year:"numeric"}).format(new Date(e.createDate)):null},group:function(e){return(0,o.jsxs)("tr",{className:"bg-slate-50 border-t-2 border-t-gray-400",children:[(0,o.jsx)("td",{className:"py-2 px-6 text-md font-bold",colSpan:7}),(0,o.jsx)("td",{className:"py-2 px-6 text-lg font-bold text-center",colSpan:1,children:e}),(0,o.jsx)("td",{className:"py-2 px-6 text-lg font-bold text-center"})]})},groupFooter:function(e,n){return(0,o.jsxs)("tr",{className:"bg-slate-50",children:[(0,o.jsx)("td",{className:"py-2 px-6 text-md font-bold",colSpan:4}),(0,o.jsx)("td",{className:"py-2 px-6 text-md font-bold",children:(0,o.jsx)(w,{value:n.filter((function(e){return Number(e.amount)>0})).reduce((function(e,n){return e+(Number(n.amount)||0)}),0)})}),(0,o.jsx)("td",{className:"py-2 px-6 text-md font-bold",children:(0,o.jsx)(w,{value:n.filter((function(e){return Number(e.amount)<0})).reduce((function(e,n){return e+(Math.abs(Number(n.amount))||0)}),0)})}),(0,o.jsx)("td",{className:"py-2 px-6 text-md font-bold",colSpan:3})]})},cells:function(e){return[e.id,(0,o.jsx)(j.C,{value:e.user,editable:q,onEdit:function(n){return le(e,"user",n)},children:null!==(D=e.user)&&void 0!==D?D:"-"}),(0,o.jsx)(j.C,{value:e.remark,onEdit:function(n){return le(e,"remark",n)},editable:q,children:null!==(T=e.remark)&&void 0!==T?T:"-"}),(null!==(F=e.amount)&&void 0!==F?F:0)>=0?(0,o.jsx)(j.C,{onEdit:function(n){return le(e,"amount",n)},value:e.amount,editable:q,children:(0,o.jsx)("span",{className:c()("rounded-lg inline-block px-2 text-rtl",{"bg-red-50 text-red-700":(null!==(E=e.amount)&&void 0!==E?E:0)>=0,"bg-green-50 text-green-700":(null!==(A=e.amount)&&void 0!==A?A:0)<0}),children:(0,o.jsx)(w,{value:e.amount})})}):null,(null!==(I=e.amount)&&void 0!==I?I:0)<0?(0,o.jsx)(j.C,{onEdit:function(n){return le(e,"amount",n)},value:e.amount,editable:q,children:(0,o.jsx)("span",{className:c()("rounded-lg inline-block px-2 text-rtl",{"bg-red-50 text-red-700":(null!==(O=e.amount)&&void 0!==O?O:0)>=0,"bg-green-50 text-green-700":(null!==(R=e.amount)&&void 0!==R?R:0)<0}),children:(0,o.jsx)(w,{value:Math.abs(null!==(W=Number(e.amount))&&void 0!==W?W:0)})})}):null,(0,o.jsx)("span",{className:c()("rounded-lg inline-block px-2 text-rtl",{"bg-red-50 text-red-700":(null!==(M=e.remain)&&void 0!==M?M:0)>=0,"bg-green-50 text-green-700":(null!==(U=e.remain)&&void 0!==U?U:0)<0}),children:(0,o.jsx)(w,{value:e.remain})}),(0,o.jsx)(g.M,{containerClassName:"text-center",precision:!0,full:J.fullTime,date:e.createDate}),(0,o.jsx)(y.Z,{text:"Actions",children:q?(0,o.jsx)(y.Z.Item,{action:function(){return L("Do you want to remove transaction ".concat(e.id," ?"),"Remove",(function(){return re(e)}))},children:"Delete"}):null})]}})]})}},7568:function(e,n,t){"use strict";function r(e,n,t,r,l,i,a){try{var u=e[i](a),o=u.value}catch(s){return void t(s)}u.done?n(o):Promise.resolve(o).then(r,l)}function l(e){return function(){var n=this,t=arguments;return new Promise((function(l,i){var a=e.apply(n,t);function u(e){r(a,l,i,u,o,"next",e)}function o(e){r(a,l,i,u,o,"throw",e)}u(void 0)}))}}t.d(n,{Z:function(){return l}})},828:function(e,n,t){"use strict";t.d(n,{Z:function(){return i}});var r=t(3375);var l=t(1566);function i(e,n){return function(e){if(Array.isArray(e))return e}(e)||(0,r.Z)(e,n)||(0,l.Z)(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}}},function(e){e.O(0,[885,966,58,923,774,888,179],(function(){return n=7674,e(e.s=n);var n}));var n=e.O();_N_E=n}]);
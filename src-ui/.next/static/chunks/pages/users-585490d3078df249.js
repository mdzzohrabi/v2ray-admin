(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[892],{4842:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/users",function(){return n(9750)}])},1257:function(e,t,n){"use strict";n.d(t,{W:function(){return c}});var r=n(5893),l=n(1664),i=n.n(l),a=n(1163),o=n(4184),s=n.n(o);n(7294);function c(e){var t=e.children,n="1"==(0,a.useRouter)().query.all;return(0,r.jsxs)("div",{className:"flex flex-col h-screen overflow-x-auto w-full text-xs xl:text-sm",children:[(0,r.jsxs)("ul",{className:"px-2 py-3 flex xl:sticky top-0 z-50 bg-slate-100",children:[n?(0,r.jsx)(u,{href:"/logs"+(n?"?all=1":""),text:"Logs"}):null,n?(0,r.jsx)(u,{href:"/usages/traffic"+(n?"?all=1":""),text:"Traffic Usages"}):null,(0,r.jsx)(u,{href:"/transactions"+(n?"?all=1":""),text:"Transactions"}),(0,r.jsx)(u,{href:"/users"+(n?"?all=1":""),text:"Users"}),n?(0,r.jsx)(u,{href:"/configuration"+(n?"?all=1":""),text:"Configuration"}):null,(0,r.jsx)(u,{href:"/server_config"+(n?"?all=1":""),text:"Servers"}),(0,r.jsx)(u,{href:"/logout",children:"Logout"})]}),(0,r.jsx)("div",{className:"bg-white block shadow-md mt-2 min-w-fit",children:t})]})}function u(e){var t=e.href,n=e.text,l=void 0===n?void 0:n,o=e.children,c=void 0===o?void 0:o,u=(0,a.useRouter)();return(0,r.jsx)(i(),{href:t,children:(0,r.jsx)("li",{className:s()("whitespace-nowrap px-3 py-1 cursor-pointer rounded-lg",{"hover:bg-white":u.asPath!=t},{"font-bold bg-slate-800 text-white":u.asPath==t}),children:null!==l&&void 0!==l?l:c})})}},3657:function(e,t,n){"use strict";n.d(t,{M:function(){return v}});var r=n(2670),l=n(5893),i=n(4184),a=n.n(i),o=n(3067),s=n.n(o),c=n(1163),u=(n(7294),n(9713)),d=n(1211);function v(e){var t=e.date,n=e.className,i=void 0===n?"":n,o=e.containerClassName,v=void 0===o?"":o,p=e.full,h=void 0!==p&&p,x=e.precision,f=void 0!==x&&x,m=e.locale,b=void 0===m?"":m,g=e.options,j=void 0===g?void 0:g,N=(0,c.useRouter)(),y="en"==(null!==b&&void 0!==b?b:N.query.date);if(!t)return(0,l.jsx)(l.Fragment,{children:"-"});t=(0,r.Z)(t,Date)?t:new Date(t);var C=new Intl.DateTimeFormat(y?"en-US":"fa-IR-u-nu-latn",null!==j&&void 0!==j?j:{timeStyle:"medium",dateStyle:"full"}),w=f?(0,u.Bh)(t).text:s()(t).locale("fa").fromNow(),k=C.format(t);return h?(0,l.jsx)(d.G,{className:v,popup:(0,l.jsx)("span",{dir:"rtl",children:w}),children:(0,l.jsx)("span",{className:a()("block text-gray-900 text-rtl",i),children:k})}):(0,l.jsx)(d.G,{popup:k,className:v,children:(0,l.jsx)("span",{className:a()("block text-gray-500 text-rtl",i),children:w})})}},1016:function(e,t,n){"use strict";n.d(t,{C:function(){return s}});var r=n(6042),l=n(5893),i=n(4184),a=n.n(i),o=n(7294);function s(e){var t=e.value,n=e.children,i=e.onEdit,s=e.className,c=void 0===s?"":s,u=e.editable,d=void 0===u||u,v=e.input,p=e.postfix,h=this,x=(0,o.useState)(!1),f=x[0],m=x[1],b=(0,o.useState)(t),g=b[0],j=b[1];(0,o.useEffect)((function(){j(t)}),[t]);var N=(0,o.useCallback)((function(e){null===e||void 0===e||e.preventDefault(),null===i||void 0===i||i.call(h,g),m(!1)}),[g]);return d?f?(0,l.jsxs)("form",{onSubmit:N,children:[(0,l.jsx)("input",(0,r.Z)({type:"text",value:g,onChange:function(e){return j(e.currentTarget.value)},className:"ring-1 ring-slate-600 rounded-lg px-1"},v)),p,(0,l.jsx)("button",{className:"text-sm ml-1 bg-slate-200 rounded-lg px-2 hover:bg-slate-800 hover:text-white",type:"submit",children:"OK"}),(0,l.jsx)("button",{onClick:function(){return m(!1)},className:"text-sm ml-1 bg-slate-200 rounded-lg px-2 hover:bg-slate-800 hover:text-white",type:"button",children:"Cancel"})]}):(0,l.jsx)("span",{className:a()("text-blue-500 ml-2 cursor-pointer px-1 rounded-lg hover:ring-slate-400 hover:ring-1 block",c),onClick:function(){return m(!f)},children:n}):(0,l.jsx)("span",{className:a()("ml-2 px-1",c),children:n})}},6550:function(e,t,n){"use strict";n.d(t,{EV:function(){return x},FE:function(){return m},GG:function(){return b},H_:function(){return h},gN:function(){return f}});var r=n(4924),l=n(6042),i=n(9396),a=n(9534),o=n(5893),s=n(4184),c=n.n(s),u=n(7294),d=n(2687),v=n(5384),p=(0,u.createContext)({});function h(e){var t=e.title,n=e.children,r=e.className,s=e.titleClassName,u=e.horizontal,d=void 0!==u&&u,v=e.layoutVertical,h=void 0!==v&&v,x=e.data,f=void 0===x?void 0:x,m=e.dataSetter,b=void 0===m?void 0:m,g=e.unsetEmpty,j=void 0===g||g,N=e.containerClassName,y=void 0===N?"":N,C=(0,a.Z)(e,["title","children","className","titleClassName","horizontal","layoutVertical","data","dataSetter","unsetEmpty","containerClassName"]),w=(0,o.jsx)(p.Provider,{value:{horizontal:d,data:f,dataSetter:b,unsetEmpty:j},children:n});return t||r?(0,o.jsxs)("div",(0,i.Z)((0,l.Z)({className:c()("flex overflow-auto",r)},C),{children:[t?(0,o.jsx)("h2",{className:c()("font-bold px-3 py-3 whitespace-nowrap",s),children:t}):null,(0,o.jsx)("div",{className:"self-center flex-1",children:(0,o.jsx)("div",{className:c()("flex flex-1",{"flex-row":!h,"flex-col":h},y),children:w})})]})):w}function x(e){var t=e.children,n=e.path,r=(0,u.useContext)(p),a=(0,u.useCallback)((function(e){if(console.log("Set Data",e,r.data,n),r.dataSetter){var t=(0,l.Z)({},r.data);!e&&r.unsetEmpty?delete t[n]:t[n]=e,console.log(t),r.dataSetter(t)}}),[r.data,r.dataSetter]),s=r.data&&r.data[n]?r.data[n]:{};return(0,o.jsx)(p.Provider,{value:(0,i.Z)((0,l.Z)({},r),{dataSetter:a,data:s}),children:t})}function f(e){var t,n,a=e.label,s=e.children,d=e.className,h=void 0===d?"":d,x=e.horizontal,f=void 0===x?void 0:x,m=e.htmlFor,b=void 0===m?"":m,g=e.data,j=void 0===g?void 0:g,N=e.dataSetter,y=void 0===N?void 0:N,C=e.unsetEmpty,w=void 0===C?void 0:C,k=this,D=(0,u.useContext)(p),Z=Array.isArray(s)?s:[s];f=null!==(t=null!==f&&void 0!==f?f:D.horizontal)&&void 0!==t&&t,j=null!==j&&void 0!==j?j:D.data,y=null!==y&&void 0!==y?y:D.dataSetter,w=null===(n=null!==w&&void 0!==w?w:D.unsetEmpty)||void 0===n||n;var P=(0,u.useCallback)((function(e){var t=e.currentTarget,n=t.value;"checkbox"==t.type&&(n=t.checked),"number"==t.type&&(n=n?Number(n):n),"object"==typeof j&&b?!n&&w?delete(j=(0,l.Z)({},j))[b]:j=(0,i.Z)((0,l.Z)({},j),(0,r.Z)({},b,n)):j=n,null===y||void 0===y||y.call(k,j,b)}),[b,j,y]);return Z=Z.map((function(e,t){if(y&&("input"==(null===e||void 0===e?void 0:e.type)||"select"==(null===e||void 0===e?void 0:e.type)||"textarea"==(null===e||void 0===e?void 0:e.type))){var n,i="value";return"checkbox"==e.props.type&&(i="checked"),(0,u.createElement)(e.type,(0,l.Z)((0,r.Z)({key:t,onChange:P},i,null!==(n=b&&"object"==typeof j?j[b]:j)&&void 0!==n?n:""),e.props))}return e})),(0,o.jsxs)("div",{className:c()("flex px-1",{"flex-col":!f,"flex-row self-center":f},h),children:[(0,o.jsx)("label",{htmlFor:b,className:c()(v.W.label,{"pr-3":f},"whitespace-nowrap"),children:a}),Z]})}function m(e){var t=e.data,n=e.dataSetter;return(0,e.children)({items:t,addItem:(0,d.un)(t,n),deleteItem:(0,d.JU)(t,n),updateItem:(0,d.NP)(t,n)})}function b(e){var t,n=e.data,r=e.dataSetter,l=e.children,i=e.path,a=(0,u.useContext)(p);i&&(n||(n=null!==(t=a.data)&&void 0!==t?t:{}));var o=(0,u.useCallback)((function(e){!r&&i&&a.dataSetter?a.dataSetter(e):r&&r(e)}),[r,a.dataSetter,n]);return l((0,d.fb)(n,o))}},5835:function(e,t,n){"use strict";n.d(t,{B:function(){return o},k:function(){return a}});var r=n(5893),l=n(4184),i=n.n(l);function a(e){var t=e.label,n=e.children,l=e.className,a=void 0===l?"":l;return(0,r.jsxs)("div",{className:i()("flex flex-row border-b-[1px] border-b-gray-200 last:border-b-0",a),children:[(0,r.jsx)("span",{className:"flex-1 text-gray-400 mr-2",children:t}),n]})}function o(e){var t=e.children,n=e.className,l=void 0===n?"":n;return(0,r.jsx)("div",{className:i()("flex flex-col",l),children:t})}},1757:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(5893),l=n(4184),i=n.n(l),a=n(7294),o=n(2687),s=n(5384);function c(e){var t=e.visible,n=void 0!==t&&t,l=e.text,c=void 0===l?"Actions":l,u=e.children,d=void 0===u?[]:u,v=this,p=(0,a.useState)(n),h=p[0],x=p[1],f=(0,a.useRef)();return(0,o.pN)(f,(function(){x(!1)})),(0,a.useEffect)((function(){"boolean"==typeof n&&x(n)}),[n,x]),(0,r.jsxs)("div",{className:"relative inline-block",children:[(0,r.jsx)("span",{onClick:function(){return x(!h)},className:i()(s.W.link,{"bg-slate-200":h}),children:c}),h?(0,r.jsx)("div",{ref:f,className:"min-w-[10rem] absolute z-50 right-0 top-full bg-white shadow-lg ring-1 ring-black ring-opacity-10 px-2 py-2 rounded-lg",children:(Array.isArray(d)?d:[d]).map((function(e,t){return e?(0,r.jsx)("div",{className:"py-1 px-2 border-b-[1px] border-b-gray-200 last:border-b-0 hover:bg-cyan-100 cursor-pointer",onClick:function(){var t;null===(t=e.props.action)||void 0===t||t.call(v,x)},children:e.props.children},t):null}))}):null]})}c.Item=function(e){return e.children,e.action,(0,r.jsx)("div",{})}},1211:function(e,t,n){"use strict";n.d(t,{G:function(){return o}});var r=n(5893),l=n(4184),i=n.n(l),a=n(7294);function o(e){var t=e.children,n=e.popup,l=e.className,o=void 0===l?"":l,s=(0,a.useState)(!1),c=s[0],u=s[1];return n?(0,r.jsxs)("div",{className:i()("inline relative cursor-help",o),onMouseOver:function(){return u(!0)},onMouseOut:function(){return u(!1)},children:[t,c?(0,r.jsx)("div",{className:"shadow-lg z-10 absolute top-full rounded-lg bg-white px-2 py-2 ring-1 ring-slate-400",children:n}):null]}):t}},7463:function(e,t,n){"use strict";n.d(t,{$:function(){return l}});var r=n(5893);function l(e){var t=e.size;if(!t)return(0,r.jsx)(r.Fragment,{children:t});for(var n=0;t>1024;)t/=1024,n++;return(0,r.jsxs)(r.Fragment,{children:[Math.round(t)," ",["B","KB","MB","GB","TB","EB"][n]]})}},2687:function(e,t,n){"use strict";n.d(t,{Ai:function(){return h},G:function(){return c},JU:function(){return u},NP:function(){return v},fb:function(){return p},pN:function(){return s},un:function(){return d}});var r=n(9815),l=n(5893),i=n(7294),a=n(6501),o=n(9713);function s(e,t){(0,i.useEffect)((function(){var n=function(n){e.current&&!e.current.contains(n.target)&&t()};return document.addEventListener("mousedown",n),function(){document.removeEventListener("mousedown",n)}}),[e,t])}function c(){return(0,i.useCallback)((function(e,t,n){var r=!1;a.ZP.custom((function(i){return(0,l.jsxs)("div",{className:"ring-1 ring-black ring-opacity-20 whitespace-nowrap text-sm shadow-lg bg-white flex rounded-lg pointer-events-auto px-3 py-2",children:[(0,l.jsx)("span",{className:"flex-1 self-center mr-3",children:e}),(0,l.jsx)("button",{className:"rounded-lg duration-150 hover:shadow-md bg-slate-100 px-2 py-1 ml-1",onClick:function(){return a.ZP.remove(i.id)},children:"Cancel"}),(0,l.jsx)("button",{className:"rounded-lg duration-150 hover:shadow-md bg-blue-400 text-white px-2 py-1 ml-1 hover:bg-blue-600",onClick:function(){a.ZP.remove(i.id),r||n(),r=!0},children:t})]})}),{position:"top-center"})}),[])}function u(e,t){return(0,i.useCallback)((function(n){t(e.filter((function(e){return e!=n})))}),[e,t])}function d(e,t){return(0,i.useCallback)((function(n,l){t((0,r.Z)(e).concat([l]))}),[e,t])}function v(e,t){return(0,i.useCallback)((function(n,l){var i=e.indexOf(n);i>=0&&(e[i]=l),t((0,r.Z)(e))}),[e,t])}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this;e||(e={});var r=(0,i.useState)(e),l=r[0],a=r[1];(0,i.useEffect)((function(){a(e)}),[e]);var s=(0,i.useCallback)((function(e){var r=(0,o.p$)(l);r&&delete r[e],null===t||void 0===t||t.call(n,r),a(r)}),[l,t]),c=(0,i.useCallback)((function(e,r){var i=(0,o.p$)(l);i&&(i[e]=r),null===t||void 0===t||t.call(n,i),a(i)}),[l,t]),u=(0,i.useCallback)((function(e,r){var i=(0,o.p$)(l);i&&(i[r]=i[e],delete i[e]),null===t||void 0===t||t.call(n,i),a(i)}),[l,t]);return{value:l,deleteKey:s,setKey:c,renameKey:u}}function h(e,t){var n,r=(0,i.useState)(null!==(n=(0,o.VL)(e))&&void 0!==n?n:t);return(0,i.useEffect)((function(){return(0,o.h)(e,r[0])}),[r[0]]),r}},5384:function(e,t,n){"use strict";n.d(t,{W:function(){return r}});var r={tableHead:"px-3 py-2 border-b-2 text-left border-b-blue-900 rounded-tl-lg rounded-tr-lg",td:"whitespace-nowrap border-b-2 py-1 px-3",button:"border-2 border-slate-200 whitespace-nowrap rounded-3xl px-5 py-1 ml-2 duration-100 hover:border-blue-400 hover:text-blue-400 disabled:text-gray-400 disabled:border-slate-100",buttonPrimary:"border-2 border-green-600 text-green-600 whitespace-nowrap rounded-3xl px-5 py-1 ml-2 duration-100 hover:border-green-900 hover:text-green-900",addButtonSmall:"whitespace-nowrap text-xs rounded-3xl px-3 py-1 duration-150 hover:ring-2 ring-green-200 bg-slate-200 hover:bg-green-700 hover:text-white",addButton:"whitespace-nowrap rounded-3xl px-3 py-1 duration-150 hover:ring-2 ring-green-200 bg-slate-200 hover:bg-green-700 hover:text-white",input:"border-gray-500 border-solid border-b-0 bg-slate-100 rounded-md invalid:border-red-500 invalid:ring-red-600 px-2 py-1 focus:outline-blue-500",label:"py-1 self-start font-semibold",link:"cursor-pointer block text-blue-800 hover:underline rounded-lg"}},9750:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var r=n(7568),l=n(6042),i=n(9396),a=n(9815),o=n(655),s=n(5893),c=n(4184),u=n.n(c),d=n(3667),v=n.n(d),p=n(9008),h=n.n(p),x=n(1163),f=n(7294),m=n(6501),b=n(8100),g=n(5384),j=n(9713),N=n(1272),y=n(6550);function C(e){var t=e.disabled,n=void 0!==t&&t,i=e.onRefresh,a=e.setLoading,c=e.protocols,u=e.className,d=void 0===u?"":u,v=(0,f.useContext)(N.I),p="1"==(0,x.useRouter)().query.all,h=(0,f.useState)({}),b=h[0],C=h[1],w=this,k=(0,f.useCallback)(function(){var e=(0,r.Z)((function(e){var t,n;return(0,o.__generator)(this,(function(r){switch(r.label){case 0:null===e||void 0===e||e.preventDefault(),r.label=1;case 1:return r.trys.push([1,3,4,5]),null===a||void 0===a||a.call(w,!0),b.quotaLimit&&(b.quotaLimit=1024*b.quotaLimit*1024*1024),[4,(0,j.Pu)(v.server,"/user",(0,l.Z)({},b))];case 2:return(t=r.sent()).error?m.ZP.error(t.error):(C({}),null===i||void 0===i||i.call(w),m.ZP.success("User added successful")),[3,5];case 3:return n=r.sent(),m.ZP.error(null===n||void 0===n?void 0:n.message),[3,5];case 4:return null===a||void 0===a||a.call(w,!1),[7];case 5:return[2]}}))}));return function(t){return e.apply(this,arguments)}}(),[b,i]);return(0,s.jsx)("form",{onSubmit:k,children:(0,s.jsxs)(y.H_,{className:d,title:"Add User",containerClassName:"items-center",data:b,dataSetter:C,children:[(0,s.jsx)(y.gN,{label:"Username",htmlFor:"email",children:(0,s.jsx)("input",{placeholder:"user",pattern:p?void 0:"^user[a-z0-9_-]+",disabled:n,className:g.W.input,type:"text",id:"email"})}),(0,s.jsx)(y.gN,{label:"FullName",htmlFor:"fullName",children:(0,s.jsx)("input",{placeholder:"Full Name",disabled:n,className:g.W.input,type:"text",id:"fullName"})}),(0,s.jsx)(y.gN,{label:"Mobile",htmlFor:"mobile",children:(0,s.jsx)("input",{placeholder:"09",inputMode:"tel",disabled:n,className:g.W.input,type:"text",id:"mobile"})}),(0,s.jsx)(y.gN,{label:"Email",htmlFor:"emailAddress",children:(0,s.jsx)("input",{placeholder:"Email",inputMode:"email",disabled:n,className:g.W.input,type:"text",id:"emailAddress"})}),(0,s.jsx)(y.gN,{label:"Bandwidth",htmlFor:"quotaLimit",children:(0,s.jsx)("input",{placeholder:"5 GB",inputMode:"numeric",disabled:n,className:g.W.input,type:"number",id:"quotaLimit"})}),(0,s.jsx)(y.gN,{label:"Protocol",htmlFor:"protocol",children:(0,s.jsxs)("select",{disabled:n,id:"protocol",className:g.W.input,children:[(0,s.jsx)("option",{value:void 0,children:"-"},"no-protocol"),null===c||void 0===c?void 0:c.map((function(e){return(0,s.jsx)("option",{value:e,children:e},"protocol-"+e)}))]})}),p?(0,s.jsx)(y.gN,{htmlFor:"private",label:"Private",children:(0,s.jsx)("input",{type:"checkbox",id:"private"})}):null,p?(0,s.jsx)(y.gN,{htmlFor:"free",label:"Free",children:(0,s.jsx)("input",{type:"checkbox",id:"free"})}):null,(0,s.jsx)("button",{disabled:n,type:"submit",className:g.W.button,children:"Add User"})]})})}var w=n(1257),k=n(2670);function D(e){var t=e.data,n=e.children,l=e.copiedText,i=void 0===l?"Copied !":l,a=e.notifyText,c=void 0===a?"Config copied to clipboard":a,d=e.className,v=void 0===d?"":d,p=(0,f.useState)(!1),h=p[0],x=p[1],b=(0,f.useState)(!1),g=b[0],j=b[1],N=(0,f.useCallback)((0,r.Z)((function(){return(0,o.__generator)(this,(function(e){switch(e.label){case 0:return"function"!=typeof t?[3,2]:(t=t(),(0,k.Z)(t,Promise)?(j(!0),[4,t]):[3,2]);case 1:t=e.sent(),j(!1),e.label=2;case 2:return(null===navigator||void 0===navigator?void 0:navigator.clipboard)?(navigator.clipboard.writeText(t),x(!0),m.ZP.success(c),setTimeout((function(){return x(!1)}),2e3),[2]):(m.ZP.error("Clipboard only works in HTTPS mode"),[2])}}))})),[t]);return(0,s.jsx)("span",{className:u()("cursor-pointer text-blue-600",v),onClick:N,children:g?"Loading ...":h?i:n})}var Z=n(3657),P=n(1016),A=n(5835),E=n(1211),S=n(1757),F=n(7463),_=n(2687);function I(){var e,t=(0,f.useContext)(N.I),n=(0,x.useRouter)(),c="1"==n.query.all,d=(0,f.useState)((0,j.VL)("users-view",{sortColumn:"",sortAsc:!0,fullTime:!1,precision:!0,showId:!1,filter:"",statusFilter:[],page:1,limit:20})),p=d[0],k=d[1];(0,f.useEffect)((function(){return(0,j.h)("users-view",p)}),[p]);var I,U,M,R=(0,b.ZP)({url:"/inbounds?key="+btoa(t.server.url),body:{private:c,view:p}},j.Pu.bind(this,t.server)),T=R.data,L=R.mutate,B=R.isValidating,W=(0,f.useCallback)(function(){var e=(0,r.Z)((function(e,n){var r,l;return(0,o.__generator)(this,(function(i){switch(i.label){case 0:return[4,(0,j.Pu)(t.server,"/client_config?protocol="+e,n).then((function(e){return e.config}))];case 1:return r=i.sent(),l="https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl="+encodeURIComponent(r),window.open(l),[2]}}))}));return function(t,n){return e.apply(this,arguments)}}(),[n]),q=(0,f.useCallback)(function(){var e=(0,r.Z)((function(e,n,r){var l,i;return(0,o.__generator)(this,(function(a){switch(a.label){case 0:return[4,(0,j.Pu)(t.server,"/active",{email:n.email,protocol:e,active:r})];case 1:return(null===(l=a.sent())||void 0===l?void 0:l.ok)?(m.ZP.success("Changes made successful"),L()):m.ZP.error(null!==(i=null===l||void 0===l?void 0:l.error)&&void 0!==i?i:"Cannot save changes"),[2]}}))}));return function(t,n,r){return e.apply(this,arguments)}}(),[n]),G=(0,f.useCallback)(function(){var e=(0,r.Z)((function(e,n){var r,l;return(0,o.__generator)(this,(function(i){switch(i.label){case 0:return[4,(0,j.Pu)(t.server,"/remove_user",{email:n.email,protocol:e})];case 1:return(null===(r=i.sent())||void 0===r?void 0:r.ok)?(m.ZP.success("User removed"),L()):m.ZP.error(null!==(l=null===r||void 0===r?void 0:r.error)&&void 0!==l?l:"Cannot remove user"),[2]}}))}));return function(t,n){return e.apply(this,arguments)}}(),[n]),z=(0,f.useCallback)(function(){var e=(0,r.Z)((function(e,n,r){var l,i;return(0,o.__generator)(this,(function(a){switch(a.label){case 0:return[4,(0,j.Pu)(t.server,"/max_connections",{email:n.email,protocol:e,value:r})];case 1:return(null===(l=a.sent())||void 0===l?void 0:l.ok)?(m.ZP.success("Max connection changed"),L()):m.ZP.error(null!==(i=null===l||void 0===l?void 0:l.error)&&void 0!==i?i:"Cannot change user settings"),[2]}}))}));return function(t,n,r){return e.apply(this,arguments)}}(),[n]),V=(0,f.useCallback)(function(){var e=(0,r.Z)((function(e,n,r){var l,i;return(0,o.__generator)(this,(function(a){switch(a.label){case 0:return[4,(0,j.Pu)(t.server,"/expire_days",{email:n.email,protocol:e,value:r})];case 1:return(null===(l=a.sent())||void 0===l?void 0:l.ok)?(m.ZP.success("Expire days changed"),L()):m.ZP.error(null!==(i=null===l||void 0===l?void 0:l.error)&&void 0!==i?i:"Cannot change user settings"),[2]}}))}));return function(t,n,r){return e.apply(this,arguments)}}(),[n]),H=(0,f.useCallback)(function(){var e=(0,r.Z)((function(e,n){var r,l;return(0,o.__generator)(this,(function(i){switch(i.label){case 0:return[4,(0,j.Pu)(t.server,"/add_days",{email:e.email,days:n})];case 1:return(null===(r=i.sent())||void 0===r?void 0:r.ok)?(m.ZP.success("".concat(n," days added to user ").concat(e.email)),L()):m.ZP.error(null!==(l=null===r||void 0===r?void 0:r.error)&&void 0!==l?l:"Cannot change user expire days"),[2]}}))}));return function(t,n){return e.apply(this,arguments)}}(),[n]),O=(0,f.useCallback)(function(){var e=(0,r.Z)((function(e,n,r){var l,i;return(0,o.__generator)(this,(function(a){switch(a.label){case 0:return[4,(0,j.Pu)(t.server,"/change_username",{email:n.email,protocol:e,value:r})];case 1:return(null===(l=a.sent())||void 0===l?void 0:l.ok)?(m.ZP.success("Username changed"),L()):m.ZP.error(null!==(i=null===l||void 0===l?void 0:l.error)&&void 0!==i?i:"Cannot change user settings"),[2]}}))}));return function(t,n,r){return e.apply(this,arguments)}}(),[n]),$=(0,f.useCallback)(function(){var e=(0,r.Z)((function(e,n,r,l){var i,a;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return[4,(0,j.Pu)(t.server,"/set_info",{email:n.email,protocol:e,value:l,prop:r})];case 1:return(null===(i=o.sent())||void 0===i?void 0:i.ok)?(m.ZP.success(r+' changed for user "'+n.email+'"'),L()):m.ZP.error(null!==(a=null===i||void 0===i?void 0:i.error)&&void 0!==a?a:"Cannot change user "+r),[2]}}))}));return function(t,n,r,l){return e.apply(this,arguments)}}(),[n]),K=(0,f.useCallback)(function(){var e=(0,r.Z)((function(e,n){var r,l;return(0,o.__generator)(this,(function(i){switch(i.label){case 0:return[4,(0,j.Pu)(t.server,"/regenerate_id",{email:n.email,protocol:e})];case 1:return(null===(r=i.sent())||void 0===r?void 0:r.ok)?(m.ZP.success("ID generated"),L()):m.ZP.error(null!==(l=null===r||void 0===r?void 0:r.error)&&void 0!==l?l:"Cannot generate new id"),[2]}}))}));return function(t,n){return e.apply(this,arguments)}}(),[n]),J=g.W.tableHead,X=(0,b.ZP)("/status_filters",j.Pu.bind(this,t.server)).data,Q=(0,_.G)(),Y=(0,f.useCallback)((function(){console.log("Export Excel");var e=new(v())({fileName:"V2Ray-Clients",datas:[{sheetData:null===T||void 0===T?void 0:T.flatMap((function(e){var t,n;return null===(t=e.settings)||void 0===t||null===(n=t.clients)||void 0===n?void 0:n.map((function(t){var n=t.billingStartDate,r=t.createDate,l=t.email,i=t.emailAddress,a=t.mobile,o=t.maxConnections,s=t.firstConnect,c=t.free,u=t.fullName,d=t.id,v=t.deActiveDate,p=t.deActiveReason,h=t.expireDays,x=t.expiredDate;return{protocol:e.protocol,free:c?"Free":"Paid",email:l,fullName:u,emailAddress:i,mobile:a,createDate:r?new Date(r):null,firstConnect:s?new Date(s):null,expireDays:h,expireDate:j.Em.addDays(n,null!==h&&void 0!==h?h:30),billingStartDate:n?new Date(n):null,maxConnections:o,id:d,deActiveDate:v?new Date(v):null,deActiveReason:p,expiredDate:x?new Date(x):null}}))})),sheetName:"Clients",sheetHeader:["Protocol","Free","Username","Full Name","Email Address","Mobile","Create Date","First Connect","Expire Days","Expire Date","Billing Start Date","Max Connections","ID","De-active Date","De-active Reason","Expired Date"]}]});e.saveExcel()}),[T]),ee=null!==(I=null===T||void 0===T?void 0:T.map((function(e){return e.settings?e.settings.totalClients:0})).reduce((function(e,t){return e>t?e:t}),0))&&void 0!==I?I:0,te=Number(Math.ceil(ee/p.limit))||1;return(0,s.jsxs)(w.W,{children:[(0,s.jsx)(h(),{children:(0,s.jsx)("title",{children:"Users"})}),(0,s.jsx)(C,{className:"py-2",disabled:B,onRefresh:L,protocols:null!==(M=null===T||void 0===T?void 0:T.map((function(e){return null!==(U=e.protocol)&&void 0!==U?U:""})))&&void 0!==M?M:[]}),(0,s.jsxs)(y.H_,{data:p,dataSetter:k,title:"View",className:"border-t-2 py-2",containerClassName:"items-center",children:[(0,s.jsx)(y.gN,{label:"Page",htmlFor:"page",children:(0,s.jsx)("select",{id:"page",className:g.W.input,children:(0,a.Z)(new Array(te)).map((function(e,t){return(0,s.jsx)("option",{value:t+1,children:t+1})}))})}),(0,s.jsx)(y.gN,{label:"Limit",htmlFor:"limit",children:(0,s.jsxs)("select",{id:"limit",className:g.W.input,children:[(0,s.jsx)("option",{value:10,children:"10"}),(0,s.jsx)("option",{value:20,children:"20"}),(0,s.jsx)("option",{value:50,children:"50"}),(0,s.jsx)("option",{value:100,children:"100"}),(0,s.jsx)("option",{value:200,children:"200"}),(0,s.jsx)("option",{value:300,children:"300"}),(0,s.jsx)("option",{value:400,children:"400"}),(0,s.jsx)("option",{value:500,children:"500"})]})}),(0,s.jsx)(y.gN,{label:"Sort",htmlFor:"sortColumn",children:(0,s.jsxs)("select",{id:"sortColumn",className:g.W.input,children:[(0,s.jsx)("option",{value:"-",children:"-"}),(0,s.jsx)("option",{value:"id",children:"ID"}),(0,s.jsx)("option",{value:"email",children:"Username"}),(0,s.jsx)("option",{value:"fullName",children:"FullName"}),(0,s.jsx)("option",{value:"mobile",children:"Mobile"}),(0,s.jsx)("option",{value:"emailAddress",children:"Email"}),(0,s.jsx)("option",{value:"maxConnections",children:"Max Connections"}),(0,s.jsx)("option",{value:"expireDays",children:"Expire Days"}),(0,s.jsx)("option",{value:"expireDate",children:"Expire Date"}),(0,s.jsx)("option",{value:"billingStartDate",children:"Billing Start Date"}),(0,s.jsx)("option",{value:"createDate",children:"Create Date"}),(0,s.jsx)("option",{value:"deActiveDate",children:"De-active Date"}),(0,s.jsx)("option",{value:"deActiveReason",children:"De-active Reason"}),(0,s.jsx)("option",{value:"firstConnect",children:"First Connect"}),(0,s.jsx)("option",{value:"lastConnect",children:"Last Connect"})]})}),(0,s.jsx)(y.gN,{label:"Order",htmlFor:"sort-order",children:(0,s.jsxs)("select",{value:(null===p||void 0===p?void 0:p.sortAsc)?"asc":"desc",id:"sort-order",className:g.W.input,onChange:function(e){return k((0,i.Z)((0,l.Z)({},p),{sortAsc:"asc"==e.currentTarget.value}))},children:[(0,s.jsx)("option",{value:"asc",children:"ASC"}),(0,s.jsx)("option",{value:"desc",children:"DESC"})]})}),(0,s.jsx)(y.gN,{label:"Filter",htmlFor:"filter",children:(0,s.jsx)("input",{type:"text",id:"filter",className:g.W.input})}),(0,s.jsxs)(y.gN,{label:"Status",htmlFor:"status",children:[(0,s.jsx)("div",{className:"flex gap-1 mb-1",children:null===(e=p.statusFilter)||void 0===e?void 0:e.map((function(e,t){return(0,s.jsx)("span",{onClick:function(){return k((0,i.Z)((0,l.Z)({},p),{statusFilter:p.statusFilter.filter((function(t){return t!=e}))}))},className:u()("whitespace-nowrap bg-slate-200 px-3 py-1 rounded-3xl cursor-pointer hover:bg-slate-700 hover:text-white"),children:e},t)}))}),(0,s.jsxs)("select",{value:"-",onChange:function(e){return k((0,i.Z)((0,l.Z)({},p),{statusFilter:(0,a.Z)(p.statusFilter).concat([e.currentTarget.value])}))},id:"statusFilter",className:"bg-slate-100 rounded-lg px-2 py-1",children:[(0,s.jsx)("option",{value:"-",children:"-"}),(null!==X&&void 0!==X?X:[]).map((function(e,t){return(0,s.jsx)("option",{value:e,children:e},t)}))]})]}),(0,s.jsx)(y.gN,{htmlFor:"fullTime",label:"Full Time",children:(0,s.jsx)("input",{type:"checkbox",id:"fullTime"})}),(0,s.jsx)(y.gN,{label:"Show ID",htmlFor:"showId",children:(0,s.jsx)("input",{type:"checkbox",id:"showId"})}),(0,s.jsx)(y.gN,{label:"Precision Date",htmlFor:"precision",children:(0,s.jsx)("input",{type:"checkbox",id:"precision"})}),(0,s.jsxs)("div",{className:"flex flex-row",children:[c?(0,s.jsx)("button",{className:g.W.button,onClick:function(){return L()},children:"Reload"}):null,(0,s.jsx)("button",{className:g.W.button,onClick:Y,children:"Export Excel"})]})]}),B?(0,s.jsx)("div",{className:"absolute bg-slate-900 text-white rounded-lg px-3 py-1 bottom-3 left-3",children:"Loading ..."}):null,(0,s.jsx)("div",{className:"",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"sticky top-0 xl:top-12 bg-white shadow-md z-40",children:(0,s.jsxs)("tr",{className:"bg-white",children:[(0,s.jsx)("th",{className:u()(J),children:"#"}),(0,s.jsx)("th",{onClick:function(){return k((0,i.Z)((0,l.Z)({},p),{sortColumn:"email",sortAsc:!p.sortAsc}))},className:u()(J,"cursor-pointer",{"bg-slate-200":"email"==p.sortColumn}),children:"User / FullName"}),(0,s.jsx)("th",{className:u()(J,"cursor-pointer"),children:"Infos"}),(0,s.jsx)("th",{className:u()(J,"cursor-pointer",{"bg-slate-200":"createDate"==p.sortColumn}),children:"Dates"}),(0,s.jsx)("th",{className:u()(J),children:"Actions"})]})}),(0,s.jsx)("tbody",{children:T?T.map((function(e){var r,l,i,a,o,d,v=null!==(l=null===(r=e.settings)||void 0===r?void 0:r.clients)&&void 0!==l?l:[],h=e.settings&&null!==(i=e.settings.totalClients)&&void 0!==i?i:0,x=e.settings&&null!==(a=e.settings.totalFiltered)&&void 0!==a?a:0,m=e.settings&&null!==(o=e.settings.from)&&void 0!==o?o:0,b=e.settings&&null!==(d=e.settings.to)&&void 0!==d?d:0,g=p.showId,N=p.fullTime,y=p.precision;return(0,s.jsxs)(f.Fragment,{children:[(0,s.jsx)("tr",{children:(0,s.jsxs)("td",{colSpan:5,className:"uppercase font-bold bg-slate-100 px-4 py-3",children:[e.protocol," ( ",m,"-",b," / ",x," users ) - Total = ",h," users"]})},"inbound-"+e.protocol),v.map((function(r,l){var i,a,o,d,v,p,h,x,f,m,b,C;return(0,s.jsxs)("tr",{className:u()("text-[0.78rem]"),children:[(0,s.jsx)("td",{className:u()("whitespace-nowrap border-b-2 py-1 px-3 border-l-0",{"border-l-red-700 text-red-900":!!r.deActiveDate}),children:l+1}),(0,s.jsx)("td",{className:"whitespace-nowrap border-b-2 py-1 px-3",children:(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)("div",{className:"items-center flex",children:(0,s.jsx)("span",{className:u()("rounded-full aspect-square inline-block w-3",{"bg-red-600":!!r.deActiveDate,"bg-green-600":!r.deActiveDate})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)(P.C,{editable:!r.firstConnect||c,className:"font-semibold inline-block",onEdit:function(t){return O(e.protocol,r,t)},value:r.email,children:r.email}),r.private?(0,s.jsx)("span",{className:"ml-2 text-xs px-2 py-0 rounded-lg bg-gray-100 text-gray-500 cursor-default",children:"Private"}):null,r.free?(0,s.jsx)("span",{className:"ml-2 text-xs px-2 py-0 rounded-lg bg-green-100 text-green-500 cursor-default",children:"Free"}):null]}),(0,s.jsx)(P.C,{className:"text-gray-600 inline-block",onEdit:function(t){return $(e.protocol,r,"fullName",t)},value:r.fullName,children:null!==(v=r.fullName)&&void 0!==v?v:"-"}),g?(0,s.jsx)(A.k,{className:"ml-3",label:"ID",children:r.id}):null,r.deActiveDate?(0,s.jsx)(A.k,{label:"De-active reason",className:"ml-2",children:(0,s.jsx)(E.G,{popup:null!==(p=null===(i=r.deActiveReason)||void 0===i?void 0:i.length)&&void 0!==p&&p?r.deActiveReason:null,children:(0,s.jsx)(P.C,{onEdit:function(t){return $(e.protocol,r,"deActiveReason",t)},value:r.deActiveReason,children:(null!==(h=null===(a=r.deActiveReason)||void 0===a?void 0:a.length)&&void 0!==h?h:0)>30?(null===(o=r.deActiveReason)||void 0===o?void 0:o.substring(0,30))+"...":null!==(x=r.deActiveReason)&&void 0!==x?x:"-"})})}):null]})]})}),(0,s.jsx)("td",{className:"whitespace-nowrap border-b-2 py-1 px-3",children:(0,s.jsxs)(A.B,{children:[(0,s.jsx)(A.k,{label:"Mobile",children:(0,s.jsx)(P.C,{onEdit:function(t){return $(e.protocol,r,"mobile",t)},value:r.mobile,children:null!==(f=r.mobile)&&void 0!==f?f:"N/A"})}),(0,s.jsx)(A.k,{label:"Email",children:(0,s.jsx)(P.C,{onEdit:function(t){return $(e.protocol,r,"emailAddress",t)},value:r.emailAddress,children:null!==(m=r.emailAddress)&&void 0!==m?m:"N/A"})}),(0,s.jsx)(A.k,{label:"Max Connections",children:(0,s.jsx)(P.C,{onEdit:function(t){return z(e.protocol,r,t)},value:r.maxConnections,children:r.maxConnections})}),(0,s.jsx)(A.k,{label:"Expire Days",children:(0,s.jsx)(P.C,{editable:c,onEdit:function(t){return V(e.protocol,r,t)},value:r.expireDays,children:r.expireDays})}),(0,s.jsx)(A.k,{label:"Bandwidth",children:(0,s.jsxs)(P.C,{input:{type:"number",placeholder:"1"},editable:c,onEdit:function(t){return $(e.protocol,r,"quotaLimit",1024*t*1024*1024)},value:r.quotaLimit,postfix:"GB",children:[(0,s.jsx)(F.$,{size:null!==(b=r.quotaUsage)&&void 0!==b?b:0})," / ",r.quotaLimit&&r.quotaLimit>0?(0,s.jsx)(F.$,{size:null!==(C=r.quotaLimit)&&void 0!==C?C:0}):"\u221e"]})})]})}),(0,s.jsx)("td",{className:"whitespace-nowrap border-b-2 py-1 px-3",children:(0,s.jsxs)("div",{className:"flex flex-col xl:flex-row",children:[(0,s.jsxs)(A.B,{className:"flex-1",children:[(0,s.jsx)(A.k,{label:"Create",children:(0,s.jsx)(Z.M,{precision:y,full:N,date:r.createDate})}),(0,s.jsx)(A.k,{label:"Billing",children:(0,s.jsx)(Z.M,{precision:y,full:N,date:r.billingStartDate})}),(0,s.jsx)(A.k,{label:"DeActived",children:(0,s.jsx)(Z.M,{precision:y,full:N,date:r.deActiveDate})}),r.deActiveDate?null:(0,s.jsx)(A.k,{label:"Until Expire",children:(0,s.jsx)(Z.M,{precision:y,full:N,date:r.expireDate})})]}),(0,s.jsxs)(A.B,{className:"flex-1 xl:ml-2",children:[(0,s.jsx)(A.k,{label:"Expired",children:(0,s.jsx)(Z.M,{precision:y,full:N,date:r.expiredDate})}),(0,s.jsx)(A.k,{label:"First Connect",children:(0,s.jsx)(Z.M,{precision:y,full:N,date:r.firstConnect})}),(0,s.jsx)(A.k,{label:"Last Connect",children:(0,s.jsx)(Z.M,{precision:y,full:N,date:r.lastConnect})}),r.quotaUsageUpdate?(0,s.jsx)(A.k,{label:"Bandwidth Update",children:(0,s.jsx)(Z.M,{precision:y,full:N,date:r.quotaUsageUpdate})}):null]})]})}),(0,s.jsx)("td",{className:"whitespace-nowrap border-b-2 py-1 px-3",children:(0,s.jsxs)(S.Z,{children:[(0,s.jsx)(S.Z.Item,{action:function(){return W(e.protocol,r)},children:"QR Code"}),(0,s.jsx)(S.Z.Item,{children:(0,s.jsx)(D,{className:"block text-inherit",notifyText:'User "'.concat(r.email,'" ID copied'),data:r.id,children:"Copy User ID"})}),(0,s.jsx)(S.Z.Item,{children:(0,s.jsx)(D,{className:"block text-inherit",notifyText:'User "'.concat(r.email,'" client config copied'),data:function(){return(0,j.Pu)(t.server,"/client_config?protocol="+e.protocol,r).then((function(e){return e.config}))},children:"Copy Config"})}),c||!(null===(d=r.deActiveReason)||void 0===d?void 0:d.includes("Expired"))?(0,s.jsx)(S.Z.Item,{action:function(){return Q("Change user ".concat(r.email," ").concat(r.deActiveDate?"active":"de-active"," ?"),r.deActiveDate?"Active":"De-active",(function(){return q(e.protocol,r,!!r.deActiveDate)}))},children:r.deActiveDate?"Active User":"De-Active User"}):null,c||!r.firstConnect?(0,s.jsx)(S.Z.Item,{action:function(){return Q("Delete user ".concat(r.email," ?"),"Delete",(function(){return G(e.protocol,r)}))},children:"Remove User"}):null,(0,s.jsx)(S.Z.Item,{action:function(){return Q("Generate ID for ".concat(r.email," ?"),"Generate",(function(){return K(e.protocol,r)}))},children:"ReGenerate ID"}),(0,s.jsx)(S.Z.Item,{action:function(){return Q('Add 1 Months to Expire Days for user "'.concat(r.email,'" ?'),"Add Expire Days",(function(){return H(r,30)}))},children:"+1 Months"}),(0,s.jsx)(S.Z.Item,{action:function(){return n.push("/transactions?user=".concat(r.email)+(c?"&all=1":""))},children:"Transactions"}),(0,s.jsx)(S.Z.Item,{action:function(){return n.push("/usages?user=".concat(r.email)+(c?"&all=1":""))},children:"Daily Usages"}),c?(0,s.jsx)(S.Z.Item,{action:function(){return n.push("/logs?all=1&filter="+r.email)},children:"Logs"}):null,!r.createDate||c?(0,s.jsx)(S.Z.Item,{action:function(){return Q('Set first connect date as create date for user "'.concat(r.email,'" ?'),"Set Create Date",(function(){return $(e.protocol,r,"createDate",r.firstConnect)}))},children:"Set First Connect as Create Date"}):null,c?(0,s.jsxs)(S.Z.Item,{action:function(){return Q('Set user "'.concat(r.email,'" ').concat(r.private?"public":"private","?"),"Change Private",(function(){return $(e.protocol,r,"private",!r.private)}))},children:["Set ",r.private?"Public":"Private"]}):null,c?(0,s.jsxs)(S.Z.Item,{action:function(){return Q('Set user "'.concat(r.email,'" as ').concat(r.free?"Non-free":"Free","?"),"Free/Paid",(function(){return $(e.protocol,r,"free",!r.free)}))},children:["Set ",r.free?"Non-Free":"Free"]}):null]})})]},r.id)}))]},"inbound-"+e.protocol)})):(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:10,className:"px-3 py-4",children:"Loading ..."})})})]})})]})}},7568:function(e,t,n){"use strict";function r(e,t,n,r,l,i,a){try{var o=e[i](a),s=o.value}catch(c){return void n(c)}o.done?t(s):Promise.resolve(s).then(r,l)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(l,i){var a=e.apply(t,n);function o(e){r(a,l,i,o,s,"next",e)}function s(e){r(a,l,i,o,s,"throw",e)}o(void 0)}))}}n.d(t,{Z:function(){return l}})}},function(e){e.O(0,[885,144,966,58,774,888,179],(function(){return t=4842,e(e.s=t);var t}));var t=e.O();_N_E=t}]);